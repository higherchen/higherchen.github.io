# 配置中心

## 一、配置 (Configuration)

**配置(Configuration) ** 这个概念每个技术人都不陌生，可以说一个不提供几个配置参数的系统都不好意思上线跟别的系统打招呼。

通过配置，我们可以在**不改变** 主干代码的情况下，**动态** 的根据业务需求去**调整** 系统行为。

那配置是什么？最**核心** 的就是 `key = value`


## 二、场景（Scene）

提到配置，主要在以下2个场景下使用的最多：

`文件类型` ：用于项目的发布（通常为**文件**，由**项目初始化** 时使用）

`键值类型` ：用于代码直接获取（通常从**数据库**、**远程接口** 获取）


## 三、常用模型（Common Model）

`文件类型` ：一般初期有些项目的配置文件会直接放到**Git** 做管理，在发布或者开发的过程中通过拉取，**合并** 到项目代码中

`键值类型` ：目前存储于数据表或者缓存中，通过**代码封装** 获取

对于上述模型：

- `优势`：**集中管理**，无论是Git配置仓库还是数据库，都可以实现集中式的管理

- `劣势`：
  - **权限** 无法细化到应用级别
  - **管理成本** 比较高，无论是Git还是数据库，都需要有相应权限以及工具才能提交


## 四、配置中心（Conf）

随着业务的发展越来越快，项目越来越多，配置的管理成本越来越高，对于每一次的配置变更：

1. 需要运维的同学提供支持，**加大** 了人力成本
2. 如果没有标准的**操作规范**，配置变更记录也不全
3. 文件类型的配置修改只能跟代码一起发布，操作很**重**
4. **可扩展性**差，**通用性**差

因此，为了解决上述问题，我们需要一个配置中心:

1. 在管理配置方面，将**权限控制**到应用级别
2. 通过UI极大的**降低管理成本**
3. 提供详细的操作**日志记录**，支持**回滚**，提高**实用性**
4. 提供API**签名加密**、**设置隐私数据**，提高**安全性**
5. 核心遵循**KV原则**，支持**横向扩展**


## 五、组件（Component）

### Consul  `Service层`

  [Consul](https://www.consul.io/intro/index.html) 拥有多个组件，作为一个工具，它能够做到**服务发现**及**服务配置**，提供基于**多数据中心**的**KV存储**方案，支持**分布式**部署（C/S模型）。

### Dashboard  `UI层`

  TODO

### Conf  `API层`

  [Conf API站点](http://YOUR_API_SITE)提供API支持应用对配置的访问（通过**签名加密**的方式提高安全性）：

  TODO

### 组件结构

  ![config](https://ws3.sinaimg.cn/large/006tKfTcgy1fqlkcused7j30hi09bjrv.jpg)


## 六、使用（Manual）

- 对于应用来说，接入到配置中心有以下几个步骤：
  TODO

- `文件类型-配置模板`的变量通过两个大括号区分，如`{{hello}}`对应的配置项名称为`hello`，其他保持不变，以下为PHP配置文件模板案例：

  ```php
    <?php
    /**
     * 文件中的 {{username}}、{{password}}
     * 将被解析为配置项 username、password
     */
    return [
        'username' => '{{username}}',
        'password' => '{{password}}',
    ];
  ```
